# 注意
- ここは事実だけを書く
- これらの情報をもとにした考察とかは別ページに書く

## フェーズ
| 名前 | 区間 |
| :-- | :-- |
| 序盤 | [0, 1) |
| 中盤 | [1, 4) |
| 終盤 | [4, 5) |
| ラスト | [5, 6) |

# 補正すべて

## やる気補正
| やる気 | 補正値 |
| :-- | :-- |
| 絶好調 | 1.10 |
| 好調 | 1.05 |
| 普通 | 1.00 |
| 不調 | 0.98 |
| 絶不調 | 0.95 |

## 基本速度補正

### 計算方法
- コースごとに最大２つの「参照ステータス」が設定されている
- 参照ステータスごとに補正値を算出してそれらを合算したものが基本速度補正
- つまり値域は [1.00, 1.40]

### 参照ステータス一覧
- スピード
- スタミナ
- パワー
- 根性
- 賢さ
- スピード＆スタミナ
- スタミナ＆パワー
- スタミナ＆根性
- パワー＆賢さ

## 補正表
| 参照ステータス | 補正 |
| [0, 300) | 0 |
| [300, 600) | 0.05 |
| [600, 900) | 0.10 |
| [900, 1000) | 0.15 |
| [1000, inf ) | 0.20 |

## バ場状態パラ補正
| バ場状態 | スピード | パワー |
| :-- | :-- | :-- |
| 良 | 0.0 | 0.0 |
| 稍重 | 0.0 | -50.0 |
| 重 | 0.0 | -50.0 |
| 不良 | -50.0 | -50.0 |

## 育成モード補正
| モード | 補正 |
| :-- | :-- |
| 育成モード | 400 |
| それ以外 | 0 |

## 脚質補正・作戦補正
| 脚質・作戦 | 体力 | 速度・序盤 | 速度・中盤 | 速度・終盤 | 速度・ラスト |
| :-- | :-- | :-- | :-- | :-- | :-- |
| 逃げ | 0.95 | 1.000 | 0.980 | 0.962 | 0.962 |
| 先行 | 0.89 | 0.978 | 0.991 | 0.975 | 0.975 |
| 差し | 1.000 | 0.938 | 0.998 | 0.994 | 0.994 |
| 追込み | 0.995 | 0.931 | 1.000 | 1.000 | 1.000 |

## 距離適性補正
| 適正 | スピード | パワー |
| :-- | :-- | :-- |
| G | 0.10 | 0.40 |
| F | 0.20 | 0.50 |
| E | 0.40 | 0.60 |
| D | 0.60 | 1.00 |
| C | 0.80 | 1.00 |
| B | 0.90 | 1.00 |
| A | 1.00 | 1.00 |
| S | 1.05 | 1.00 |

# 賢さランダム補正下限・賢さランダム補正上限
| 補正賢さ | 下限 | 上限 |
| :-- | :-- | :-- |
| 100	| -0.63 | 0.01 |
| 200	| -0.60 | 0.04 |
| 300	| -0.56 | 0.08 |
| 400	| -0.53 | 0.11 |
| 500	| -0.49 | 0.15 |
| 600	| -0.45 | 0.19 |
| 700	| -0.41 | 0.23 |
| 800	| -0.37 | 0.27 |
| 900	| -0.33 | 0.31 |
| 1000	| -0.28 | 0.36 |
| 1100	| -0.24 | 0.40 |
| 1200	| -0.19 | 0.45 |

## ポジションキープ補正
| 状態 | 補正 |
| :-- | :-- |
| 通常 | 1.00 |
| スピードアップ | 1.04 |
| 追い抜き | 1.05 |
| ペースダウン | 0.915 |
| ペースアップ | 1.04 |

## ポジションムーブ補正
| 状態 | 補正 |
| :-- | :-- |
| 抜け出し | 0.01 |
| 移動 | 0.01 |
| 追いかけ | 0.03 |
| その他 | 0.10 |

## ブロック補正
- 細かい説明がない

## バ場適正補正
| 適正 | 補正 |
| :-- | :-- |
| G | 0.1 |
| F | 0.3 |
| E | 0.5 |
| D | 0.7 |
| C | 0.8 |
| B | 0.9 |
| A | 1.0 |
| S | 1.05 |

## バ場状態体力消費速度補正
| 状態 | 芝 | ダート |
| :-- | :-- | :-- |
| 良 | 1.00 | 1.00 |
| 稍重 | 1.00 | 1.00 |
| 重 | 1.02 | 1.01 |
| 不良 | 1.02 | 1.02 |

## ウマ状態補正
| 状態 | 補正 |
| :-- | :-- |
| 通常 | 1.0 |
| 掛かり | 1.6 |
| ポジションキープ | 0.6 |
| ペースダウン | 0.6 |
| 下り | 0.4 |

# 数式すべて

## 補正された基礎パラメータ
```
補正スピード = スピード * やる気補正 * 基本速度補正 + バ場状態パラ補正 + 育成モード補正 + スキル補正
```

```
補正賢さ = 賢さ * やる気補正 * 脚質補正 + 育成モード補正 + スキル補正
```

```
{ 補正スタミナ, 補正パワー, 補正根性 } = { スタミナ, パワー, 根性 } * やる気補正 + バ場状態パラ補正 + 育成モード補正 + スキル補正
```

## 基礎目標速度
```
基礎目標速度 = sqrt( 500 * 補正スピード ) * 距離適性補正 * 0.002 + レース基準速度 * ( 脚質補正 + 賢さランダム補正 ) [m/sec]
```

```
レース基準速度 = 20 - ( 2000 - レース距離 ) * 0.001 [m/sec]
```
要するに +100m で -0.1[m/sec]

```
賢さランダム補正 = rand_uniform( 賢さランダム補正下限, 賢さランダム補正上限 )
```

```
賢さランダム補正下限 = 賢さランダム補正上限 - 0.65
```

```
賢さランダム補正上限 = ( 補正賢さ / 5500 ) * log( 補正賢さ * 0.1 )
```

## 通常状態の目標速度
※ポジショニングによる補正は式があってるかかなり怪しい

ポジションキープ中なら
```
目標速度 = 基礎目標速度 * ポジションキープ補正 + 坂補正 [m/sec]
```

ポジションムーブ中なら
```
目標速度 = 基礎目標速度 + ポジションムーブ補正 + 坂補正 [m/sec]
```

上り坂なら
```
坂補正 = -abs( 100 * tan( 傾斜角 * 0.017453 ) ) * 200 / 補正パワー [m/sec]
```

下り坂なら
```
坂補正 = 0.3 + abs( 100 * tan( 傾斜角 * 0.017453 ) ) / 10.0 [m/sec]
```

## スパート時の目標速度
通常は
```
目標速度 = 1.05 * ( 基礎目標速度 + 0.01 * レース基準速度 ) + sqrt( 500 * 補正スピード ) * 距離適性補正 * 0.002
```

スタミナが切れた場合
```
目標速度 = レース基準速度 * 0.85 + sqrt( 補正根性 * 200 ) * 0.001 [m/sec]
```

前のウマにブロックされている場合
```
目標速度 = Lerp( 0.988, 1.0, 前のウマ娘との距離差 / ブロック補正 ) * ブロックしているウマ娘の現在速度
```

## 加速度
```
加速度 = 脚質補正 * 0.0006 * sqrt( 補正パワー * 500 ) * バ場適正補正 [m/sec^2]
```
ただしスタート直後は 24.0 [m/sec^2] で固定

減速は
| 状態 | 加速度 |
| :-- | :-- |
| 通常 | 1.0 |
| 序盤 | 1.2 |
| 中盤 | 0.8 |
| 終盤 | 1.0 |
| 体力切れ | 1.2 |

## 体力
```
初期体力上限 = レース距離 + 脚質補正 * 0.8 * 補正スタミナ
```

```
体力消耗速度 = 20 * 体力消耗速度補正 * バ場状態体力消費速度補正 * ウマ状態補正 * スパート補正
```

```
体力消耗速度補正 = ( 現在の速度 - レース基準速度 + 12 ) ^ 2 / 144
```

```
スパート補正 = 1 + 200 / sqrt( 600 * 根性補正 )
```

## レーン変更速度
- #TODO

# スキル補正
- スピード系スキル補正は「現在の速度」に直接加算

# 参考
- [ウマ娘解析一部翻訳(速度計算式、加速度計算式、体力計算式)｜エアーマン｜note](https://note.com/earman178/n/n19a8dc5c1b32)
    - 式を間違えまくってたので、結局元ネタの掲示板とにらめっこする羽目になった
- https://twitter.com/kak_eng/status/1401489761466945536
    - レーン変更周りの挙動はこれ